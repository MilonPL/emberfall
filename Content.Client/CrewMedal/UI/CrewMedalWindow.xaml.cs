using Robust.Client.UserInterface.CustomControls;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.XAML;

namespace Content.Client.CrewMedal.UI;

[GenerateTypedNameReferences]
public sealed partial class CrewMedalWindow : DefaultWindow
{
    public event Action<string>? OnReasonChanged;

    /// <summary>
    /// Is the user currently entering text into the control?
    /// </summary>
    private bool _focused;

    private string _reason = string.Empty;

    public CrewMedalWindow()
    {
        RobustXamlLoader.Load(this);

        ReasonLineEdit.OnTextChanged += _ => SaveButton.Disabled = false;
        ReasonLineEdit.OnFocusEnter += _ => _focused = true;
        ReasonLineEdit.OnFocusExit += _ => _focused = false;

        SaveButton.OnPressed += _ =>
        {
            OnReasonChanged?.Invoke(ReasonLineEdit.Text);
            SaveButton.Disabled = true;
        };
    }

    public void SetCurrentReason(string reason)
    {
        if (reason == _reason)
            return;

        _reason = reason;
        if (!_focused)
            ReasonLineEdit.Text = reason;
    }
}
