using Content.Client.Administration.Managers;
using Robust.Client.AutoGenerated;
using Robust.Client.Console;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;

namespace Content.Client.Administration.UI.CustomControls;

[GenerateTypedNameReferences]
public sealed partial class UsernameBanListEntry : BoxContainer
{
    public UsernameBanListEntry()
    {
        RobustXamlLoader.Load(this);
    }

    public void Setup(UsernameCacheLine usernameBan)
    {
        Update(usernameBan);
        PardonUsernameBanButton.OnPressed += HandlePardonPressed(usernameBan);
    }

    private Action<BaseButton.ButtonEventArgs> HandlePardonPressed(UsernameCacheLine usernameBan)
    {
        return args =>
        {
            IoCManager.Resolve<IClientConsoleHost>().ExecuteCommand($"pardonusername {usernameBan.Id}");
        };
    }

    private void Update(UsernameCacheLine usernameBan)
    {
        UsernameBanEntryLabel.Text = $"{usernameBan.Id} {usernameBan.Expression}";
        if (usernameBan.Regex)
        {
            UsernameBanEntryLabel.FontColorOverride = Color.Yellow;
        }
    }
}
